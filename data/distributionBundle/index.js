#!/usr/bin/env node
// -*- coding: utf-8 -*-
/** @module index */
'use strict';

// region import
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.requestHandler = void 0;
var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _clientnode = require("clientnode");
var _http = require("http");
var _polyfillLibrary = _interopRequireDefault(require("polyfill-library"));
var _url = _interopRequireDefault(require("url"));
var _process$argv$;
function _createForOfIteratorHelper(r, e) { var t = "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (!t) { if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && "number" == typeof r.length) { t && (r = t); var _n = 0, F = function F() {}; return { s: F, n: function n() { return _n >= r.length ? { done: !0 } : { done: !1, value: r[_n++] }; }, e: function e(r) { throw r; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var o, a = !0, u = !1; return { s: function s() { t = t.call(r); }, n: function n() { var r = t.next(); return a = r.done, r; }, e: function e(r) { u = !0, o = r; }, f: function f() { try { a || null == t["return"] || t["return"](); } finally { if (u) throw o; } } }; }
function _unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }
function _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }
// endregion
// region types
var Flags = ['always', 'gated'];
var UnknownTechnologyConfigurations = ['ignore', 'polyfill'];
// endregion
var requestHandler = exports.requestHandler = /*#__PURE__*/function () {
  var _ref = (0, _asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee(request, response) {
    var queryParameter, excludes, _iterator, _step, parameter, features, _iterator2, _step2, _parameter, flags, _iterator3, _step3, _parameter2, givenUnknown, unknown, featureOptions, _iterator4, _step4, feature, _configuration, option, configuration, _t, _t2, _t3;
    return _regenerator["default"].wrap(function (_context) {
      while (1) switch (_context.prev = _context.next) {
        case 0:
          _context.prev = 0;
          console.info('Got request url', request.url);
          if (!request.url.startsWith('/polyfill.')) {
            _context.next = 2;
            break;
          }
          // region parse query parameter
          queryParameter = _url["default"].parse(request.url, true).query;
          excludes = [];
          _iterator = _createForOfIteratorHelper([].concat(queryParameter.excludes || []));
          try {
            for (_iterator.s(); !(_step = _iterator.n()).done;) {
              parameter = _step.value;
              excludes = excludes.concat(parameter.split(','));
            }
          } catch (err) {
            _iterator.e(err);
          } finally {
            _iterator.f();
          }
          features = [];
          _iterator2 = _createForOfIteratorHelper([].concat(queryParameter.features || []));
          try {
            for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {
              _parameter = _step2.value;
              features = features.concat(_parameter.split(','));
            }
          } catch (err) {
            _iterator2.e(err);
          } finally {
            _iterator2.f();
          }
          flags = [];
          _iterator3 = _createForOfIteratorHelper([].concat(queryParameter.flags || []));
          try {
            for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {
              _parameter2 = _step3.value;
              flags = flags.concat(_parameter2.split(',').filter(function (flagCandidate) {
                return Flags.includes(flagCandidate);
              }));
            }
          } catch (err) {
            _iterator3.e(err);
          } finally {
            _iterator3.f();
          }
          givenUnknown = [].concat(queryParameter.unknown || []);
          unknown = givenUnknown.length && UnknownTechnologyConfigurations.includes(givenUnknown[0]) ? givenUnknown[0] : 'polyfill'; // endregion
          // region build feature options
          featureOptions = {};
          _iterator4 = _createForOfIteratorHelper(features);
          try {
            for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {
              feature = _step4.value;
              _configuration = feature.split('|');
              option = _configuration[0];
              featureOptions[option] = {
                flags: _configuration.length > 1 ? _configuration[1] : flags
              };
            }
            // endregion
            // region build configuration and log
          } catch (err) {
            _iterator4.e(err);
          } finally {
            _iterator4.f();
          }
          configuration = {
            excludes: excludes,
            features: featureOptions,
            minify: request.url.includes('.min.js?'),
            uaString: request.headers['user-agent'],
            unknown: unknown
          };
          console.info('Apply polyfill configuration: "' + "".concat((0, _clientnode.represent)(configuration), "\""));
          // endregion
          // region write response
          response.statusCode = 200;
          response.setHeader('Content-Type', 'text/javascript; charset=utf-8');
          _t = response;
          _context.next = 1;
          return _polyfillLibrary["default"].getPolyfillString(configuration);
        case 1:
          _t2 = _context.sent;
          _t.write.call(_t, _t2);
          _context.next = 3;
          break;
        case 2:
          response.statusCode = 404;
        case 3:
          _context.next = 5;
          break;
        case 4:
          _context.prev = 4;
          _t3 = _context["catch"](0);
          console.warn('Error occurred:', _t3);
          response.statusCode = 500;
        case 5:
          _context.prev = 5;
          response.end();
          return _context.finish(5);
        case 6:
        case "end":
          return _context.stop();
      }
    }, _callee, null, [[0, 4, 5, 6]]);
  }));
  return function requestHandler(_x, _x2) {
    return _ref.apply(this, arguments);
  };
}();
var instance = (0, _http.createServer)(function () {
  void requestHandler.apply(void 0, arguments);
});
var port = parseInt((_process$argv$ = process.argv[2]) !== null && _process$argv$ !== void 0 ? _process$argv$ : process.env.PORT ? process.env.PORT : 8080);
instance.listen(port, function () {
  console.info("Listen on port ".concat(String(port), " for incoming requests."));
});
var _iterator5 = _createForOfIteratorHelper(_clientnode.CLOSE_EVENT_NAMES),
  _step5;
try {
  var _loop = function _loop() {
    var name = _step5.value;
    process.on(name, function () {
      console.info("\nGot \"".concat(name, "\" signal: stopping server."));
      instance.close(function () {
        console.info('Server stopped.');
      });
    });
  };
  for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {
    _loop();
  }
} catch (err) {
  _iterator5.e(err);
} finally {
  _iterator5.f();
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwicmVxdWVzdEhhbmRsZXIiLCJfcmVnZW5lcmF0b3IiLCJfYXN5bmNUb0dlbmVyYXRvcjIiLCJfY2xpZW50bm9kZSIsIl9odHRwIiwiX3BvbHlmaWxsTGlicmFyeSIsIl91cmwiLCJfcHJvY2VzcyRhcmd2JCIsIl9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIiwiciIsImUiLCJ0IiwiU3ltYm9sIiwiaXRlcmF0b3IiLCJBcnJheSIsImlzQXJyYXkiLCJfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkiLCJsZW5ndGgiLCJfbiIsIkYiLCJzIiwibiIsImRvbmUiLCJmIiwiVHlwZUVycm9yIiwibyIsImEiLCJ1IiwiY2FsbCIsIm5leHQiLCJfYXJyYXlMaWtlVG9BcnJheSIsInRvU3RyaW5nIiwic2xpY2UiLCJjb25zdHJ1Y3RvciIsIm5hbWUiLCJmcm9tIiwidGVzdCIsIkZsYWdzIiwiVW5rbm93blRlY2hub2xvZ3lDb25maWd1cmF0aW9ucyIsIl9yZWYiLCJtYXJrIiwiX2NhbGxlZSIsInJlcXVlc3QiLCJyZXNwb25zZSIsInF1ZXJ5UGFyYW1ldGVyIiwiZXhjbHVkZXMiLCJfaXRlcmF0b3IiLCJfc3RlcCIsInBhcmFtZXRlciIsImZlYXR1cmVzIiwiX2l0ZXJhdG9yMiIsIl9zdGVwMiIsIl9wYXJhbWV0ZXIiLCJmbGFncyIsIl9pdGVyYXRvcjMiLCJfc3RlcDMiLCJfcGFyYW1ldGVyMiIsImdpdmVuVW5rbm93biIsInVua25vd24iLCJmZWF0dXJlT3B0aW9ucyIsIl9pdGVyYXRvcjQiLCJfc3RlcDQiLCJmZWF0dXJlIiwiX2NvbmZpZ3VyYXRpb24iLCJvcHRpb24iLCJjb25maWd1cmF0aW9uIiwiX3QiLCJfdDIiLCJfdDMiLCJ3cmFwIiwiX2NvbnRleHQiLCJwcmV2IiwiY29uc29sZSIsImluZm8iLCJ1cmwiLCJzdGFydHNXaXRoIiwicGFyc2UiLCJxdWVyeSIsImNvbmNhdCIsInNwbGl0IiwiZXJyIiwiZmlsdGVyIiwiZmxhZ0NhbmRpZGF0ZSIsImluY2x1ZGVzIiwibWluaWZ5IiwidWFTdHJpbmciLCJoZWFkZXJzIiwicmVwcmVzZW50Iiwic3RhdHVzQ29kZSIsInNldEhlYWRlciIsInBvbHlmaWxsTGlicmFyeSIsImdldFBvbHlmaWxsU3RyaW5nIiwic2VudCIsIndyaXRlIiwid2FybiIsImVuZCIsImZpbmlzaCIsInN0b3AiLCJfeCIsIl94MiIsImFwcGx5IiwiYXJndW1lbnRzIiwiaW5zdGFuY2UiLCJjcmVhdGVTZXJ2ZXIiLCJwb3J0IiwicGFyc2VJbnQiLCJwcm9jZXNzIiwiYXJndiIsImVudiIsIlBPUlQiLCJsaXN0ZW4iLCJTdHJpbmciLCJfaXRlcmF0b3I1IiwiQ0xPU0VfRVZFTlRfTkFNRVMiLCJfc3RlcDUiLCJfbG9vcCIsIm9uIiwiY2xvc2UiXSwic291cmNlcyI6WyJpbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAjIS91c3IvYmluL2VudiBiYWJlbC1ub2RlXG4vLyAtKi0gY29kaW5nOiB1dGYtOCAtKi1cbi8qKiBAbW9kdWxlIGluZGV4ICovXG4ndXNlIHN0cmljdCdcbi8vIHJlZ2lvbiBpbXBvcnRcbmltcG9ydCB7Q0xPU0VfRVZFTlRfTkFNRVMsIE1hcHBpbmcsIHJlcHJlc2VudH0gZnJvbSAnY2xpZW50bm9kZSdcbmltcG9ydCB7XG4gICAgY3JlYXRlU2VydmVyIGFzIGNyZWF0ZUh0dHAyU2VydmVyLFxuICAgIEh0dHAyU2VydmVyIGFzIEh0dHBTZXJ2ZXIsXG4gICAgSHR0cDJTZXJ2ZXJSZXNwb25zZSBhcyBIVFRQU2VydmVyUmVzcG9uc2UsXG4gICAgSHR0cDJTZXJ2ZXJSZXF1ZXN0IGFzIEhUVFBTZXJ2ZXJSZXF1ZXN0XG59IGZyb20gJ2h0dHAyJ1xuaW1wb3J0IHtjcmVhdGVTZXJ2ZXJ9IGZyb20gJ2h0dHAnXG5pbXBvcnQgcG9seWZpbGxMaWJyYXJ5IGZyb20gJ3BvbHlmaWxsLWxpYnJhcnknXG5pbXBvcnQgdXJsIGZyb20gJ3VybCdcbi8vIGVuZHJlZ2lvblxuLy8gcmVnaW9uIHR5cGVzXG5jb25zdCBGbGFncyA9IFsnYWx3YXlzJywgJ2dhdGVkJ10gYXMgY29uc3RcbnR5cGUgRmxhZyA9IHR5cGVvZiBGbGFnc1tudW1iZXJdXG5jb25zdCBVbmtub3duVGVjaG5vbG9neUNvbmZpZ3VyYXRpb25zID0gWydpZ25vcmUnLCAncG9seWZpbGwnXSBhcyBjb25zdFxudHlwZSBVbmtub3duVGVjaG5vbG9neUNvbmZpZ3VyYXRpb24gPVxuICAgIHR5cGVvZiBVbmtub3duVGVjaG5vbG9neUNvbmZpZ3VyYXRpb25zW251bWJlcl1cbi8vIGVuZHJlZ2lvblxuZXhwb3J0IGNvbnN0IHJlcXVlc3RIYW5kbGVyID0gYXN5bmMgKFxuICAgIHJlcXVlc3Q6IEhUVFBTZXJ2ZXJSZXF1ZXN0LCByZXNwb25zZTogSFRUUFNlcnZlclJlc3BvbnNlXG4pOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zb2xlLmluZm8oJ0dvdCByZXF1ZXN0IHVybCcsIHJlcXVlc3QudXJsKVxuXG4gICAgICAgIGlmIChyZXF1ZXN0LnVybC5zdGFydHNXaXRoKCcvcG9seWZpbGwuJykpIHtcbiAgICAgICAgICAgIC8vIHJlZ2lvbiBwYXJzZSBxdWVyeSBwYXJhbWV0ZXJcbiAgICAgICAgICAgIGNvbnN0IHF1ZXJ5UGFyYW1ldGVyID0gdXJsLnBhcnNlKHJlcXVlc3QudXJsLCB0cnVlKS5xdWVyeVxuXG4gICAgICAgICAgICBsZXQgZXhjbHVkZXM6IEFycmF5PHN0cmluZz4gPSBbXVxuICAgICAgICAgICAgZm9yIChjb25zdCBwYXJhbWV0ZXIgb2YgKFtdIGFzIEFycmF5PHN0cmluZz4pLmNvbmNhdChcbiAgICAgICAgICAgICAgICBxdWVyeVBhcmFtZXRlci5leGNsdWRlcyB8fCBbXVxuICAgICAgICAgICAgKSlcbiAgICAgICAgICAgICAgICBleGNsdWRlcyA9IGV4Y2x1ZGVzLmNvbmNhdChwYXJhbWV0ZXIuc3BsaXQoJywnKSlcblxuICAgICAgICAgICAgbGV0IGZlYXR1cmVzOiBBcnJheTxzdHJpbmc+ID0gW11cbiAgICAgICAgICAgIGZvciAoY29uc3QgcGFyYW1ldGVyIG9mIChbXSBhcyBBcnJheTxzdHJpbmc+KS5jb25jYXQoXG4gICAgICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXIuZmVhdHVyZXMgfHwgW11cbiAgICAgICAgICAgICkpXG4gICAgICAgICAgICAgICAgZmVhdHVyZXMgPSBmZWF0dXJlcy5jb25jYXQocGFyYW1ldGVyLnNwbGl0KCcsJykpXG5cbiAgICAgICAgICAgIGxldCBmbGFnczogQXJyYXk8RmxhZz4gPSBbXVxuICAgICAgICAgICAgZm9yIChjb25zdCBwYXJhbWV0ZXIgb2YgKFtdIGFzIEFycmF5PHN0cmluZz4pLmNvbmNhdChcbiAgICAgICAgICAgICAgICBxdWVyeVBhcmFtZXRlci5mbGFncyB8fCBbXVxuICAgICAgICAgICAgKSlcbiAgICAgICAgICAgICAgICBmbGFncyA9IGZsYWdzLmNvbmNhdChcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3BsaXQoJywnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcigoZmxhZ0NhbmRpZGF0ZTogc3RyaW5nKTogYm9vbGVhbiA9PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZsYWdzLmluY2x1ZGVzKGZsYWdDYW5kaWRhdGUgYXMgRmxhZylcbiAgICAgICAgICAgICAgICAgICAgICAgICkgYXMgQXJyYXk8RmxhZz5cbiAgICAgICAgICAgICAgICApXG5cbiAgICAgICAgICAgIGNvbnN0IGdpdmVuVW5rbm93bjogQXJyYXk8c3RyaW5nPiA9XG4gICAgICAgICAgICAgICAgKFtdIGFzIEFycmF5PHN0cmluZz4pLmNvbmNhdChxdWVyeVBhcmFtZXRlci51bmtub3duIHx8IFtdKVxuICAgICAgICAgICAgY29uc3QgdW5rbm93bjogVW5rbm93blRlY2hub2xvZ3lDb25maWd1cmF0aW9uID1cbiAgICAgICAgICAgICAgICBnaXZlblVua25vd24ubGVuZ3RoICYmXG4gICAgICAgICAgICAgICAgVW5rbm93blRlY2hub2xvZ3lDb25maWd1cmF0aW9ucy5pbmNsdWRlcyhcbiAgICAgICAgICAgICAgICAgICAgZ2l2ZW5Vbmtub3duWzBdIGFzIFVua25vd25UZWNobm9sb2d5Q29uZmlndXJhdGlvblxuICAgICAgICAgICAgICAgICkgP1xuICAgICAgICAgICAgICAgICAgICBnaXZlblVua25vd25bMF0gYXMgVW5rbm93blRlY2hub2xvZ3lDb25maWd1cmF0aW9uIDpcbiAgICAgICAgICAgICAgICAgICAgJ3BvbHlmaWxsJ1xuICAgICAgICAgICAgLy8gZW5kcmVnaW9uXG4gICAgICAgICAgICAvLyByZWdpb24gYnVpbGQgZmVhdHVyZSBvcHRpb25zXG4gICAgICAgICAgICBjb25zdCBmZWF0dXJlT3B0aW9uczogTWFwcGluZzx7IGZsYWdzOiBBcnJheTxGbGFnPiB9PiA9IHt9XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGZlYXR1cmUgb2YgZmVhdHVyZXMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb25maWd1cmF0aW9uID1cbiAgICAgICAgICAgICAgICAgICAgZmVhdHVyZS5zcGxpdCgnfCcpIGFzIFtzdHJpbmcsIC4uLkFycmF5PEZsYWc+XVxuXG4gICAgICAgICAgICAgICAgY29uc3Qgb3B0aW9uID0gY29uZmlndXJhdGlvblswXVxuXG4gICAgICAgICAgICAgICAgZmVhdHVyZU9wdGlvbnNbb3B0aW9uXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgZmxhZ3M6IGNvbmZpZ3VyYXRpb24ubGVuZ3RoID4gMSA/XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uWzFdIGFzIHVua25vd24gYXMgQXJyYXk8RmxhZz4gOlxuICAgICAgICAgICAgICAgICAgICAgICAgZmxhZ3NcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBlbmRyZWdpb25cbiAgICAgICAgICAgIC8vIHJlZ2lvbiBidWlsZCBjb25maWd1cmF0aW9uIGFuZCBsb2dcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZ3VyYXRpb24gPSB7XG4gICAgICAgICAgICAgICAgZXhjbHVkZXMsXG4gICAgICAgICAgICAgICAgZmVhdHVyZXM6IGZlYXR1cmVPcHRpb25zLFxuICAgICAgICAgICAgICAgIG1pbmlmeTogcmVxdWVzdC51cmwuaW5jbHVkZXMoJy5taW4uanM/JyksXG4gICAgICAgICAgICAgICAgdWFTdHJpbmc6IHJlcXVlc3QuaGVhZGVyc1sndXNlci1hZ2VudCddLFxuICAgICAgICAgICAgICAgIHVua25vd25cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc29sZS5pbmZvKFxuICAgICAgICAgICAgICAgICdBcHBseSBwb2x5ZmlsbCBjb25maWd1cmF0aW9uOiBcIicgK1xuICAgICAgICAgICAgICAgIGAke3JlcHJlc2VudChjb25maWd1cmF0aW9uKX1cImBcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC8vIGVuZHJlZ2lvblxuICAgICAgICAgICAgLy8gcmVnaW9uIHdyaXRlIHJlc3BvbnNlXG4gICAgICAgICAgICByZXNwb25zZS5zdGF0dXNDb2RlID0gMjAwXG4gICAgICAgICAgICByZXNwb25zZS5zZXRIZWFkZXIoXG4gICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZScsICd0ZXh0L2phdmFzY3JpcHQ7IGNoYXJzZXQ9dXRmLTgnXG4gICAgICAgICAgICApXG4gICAgICAgICAgICByZXNwb25zZS53cml0ZShcbiAgICAgICAgICAgICAgICBhd2FpdCBwb2x5ZmlsbExpYnJhcnkuZ2V0UG9seWZpbGxTdHJpbmcoY29uZmlndXJhdGlvbikgYXNcbiAgICAgICAgICAgICAgICAgICAgc3RyaW5nXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAvLyBlbmRyZWdpb25cbiAgICAgICAgfSBlbHNlXG4gICAgICAgICAgICByZXNwb25zZS5zdGF0dXNDb2RlID0gNDA0XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdFcnJvciBvY2N1cnJlZDonLCBlcnJvcilcbiAgICAgICAgcmVzcG9uc2Uuc3RhdHVzQ29kZSA9IDUwMFxuICAgIH0gZmluYWxseSB7XG4gICAgICAgIHJlc3BvbnNlLmVuZCgpXG4gICAgfVxufVxuXG5jb25zdCBpbnN0YW5jZTpIdHRwU2VydmVyID0gKFxuICAgIGNyZWF0ZVNlcnZlciBhcyB1bmtub3duIGFzIHR5cGVvZiBjcmVhdGVIdHRwMlNlcnZlclxuKSgoLi4ucGFyYW1ldGVycykgPT4ge1xuICAgIHZvaWQgcmVxdWVzdEhhbmRsZXIoLi4ucGFyYW1ldGVycylcbn0pXG5cbmNvbnN0IHBvcnQgPVxuICAgIHBhcnNlSW50KHByb2Nlc3MuYXJndlsyXSA/PyAocHJvY2Vzcy5lbnYuUE9SVCA/IHByb2Nlc3MuZW52LlBPUlQgOiA4MDgwKSlcblxuaW5zdGFuY2UubGlzdGVuKFxuICAgIHBvcnQsICgpID0+IHtcbiAgICAgICAgY29uc29sZS5pbmZvKGBMaXN0ZW4gb24gcG9ydCAke1N0cmluZyhwb3J0KX0gZm9yIGluY29taW5nIHJlcXVlc3RzLmApXG4gICAgfVxuKVxuXG5mb3IgKGNvbnN0IG5hbWUgb2YgQ0xPU0VfRVZFTlRfTkFNRVMpXG4gICAgcHJvY2Vzcy5vbihuYW1lLCAoKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuaW5mbyhgXFxuR290IFwiJHtuYW1lfVwiIHNpZ25hbDogc3RvcHBpbmcgc2VydmVyLmApXG5cbiAgICAgICAgaW5zdGFuY2UuY2xvc2UoKCkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5pbmZvKCdTZXJ2ZXIgc3RvcHBlZC4nKVxuICAgICAgICB9KVxuICAgIH0pXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7O0FBQ1o7QUFBQSxJQUFBQSxzQkFB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